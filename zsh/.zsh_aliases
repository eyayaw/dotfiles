# ---------------------------------------------------------------
# alias_fallback  <alias-name>  <primary-command>  [fallback-cmd]
#
# • Creates an alias called <alias-name>.
# • If <primary-command> exists in PATH, the alias points to it.
# • Otherwise, if [fallback-cmd] is given, the alias points there.
# • If no fallback is supplied and the primary is missing, nothing
#   is aliased and the function exits with status 1.
#
# Example usage
#   alias_fallback r radian R        # r → radian or R
#   alias_fallback py python3        # py → python3 (no fallback)
# ---------------------------------------------------------------
alias_fallback() {
  if (( $# < 2 || $# > 3 )); then
    printf 'Usage: alias_fallback <alias-name> <primary-cmd> [fallback-cmd]\n' >&2
    return 1
  fi

  local _name="$1"
  local _primary="$2"
  local _fallback="${3:-}"

  if command -v "$_primary" >/dev/null 2>&1; then
    builtin alias "$_name"="$_primary"
  elif [[ -n "$_fallback" ]]; then
    builtin alias "$_name"="$_fallback"
  else
    printf 'alias_fallback: "%s" not found and no fallback provided\n' "$_primary" >&2
    return 1
  fi
}


# General/System aliases
alias_fallback vim nvim
alias reload='. ~/.zshrc'
alias clc='clear' # as in matlab
alias untar="tar -zxvf"
alias mkcd='mkdir_cd(){ mkdir -p "$1"; cd "$1" }; mkdir_cd '
alias rmrf="rm -rf"
alias up="cd ../"
alias c='tr -d '\''\n'\'' | pbcopy'
alias_fallback cat bat
alias_fallback ls eza "ls -G"

alias sudo='sudo '
alias map='xargs -n1'
alias mergepdf='gs -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=_merged.pdf'
alias path='echo -e ${PATH//:/\\n}'
alias plistbuddy='/usr/libexec/PlistBuddy'
alias urlencode='python3 -c "import sys;from urllib import parse;print(parse.quote_plus(sys.argv[1]));"'
alias week='date +%V'

alias lock='pmset displaysleepnow'
alias dnsflush='sudo killall -HUP mDNSResponder'
alias update='sudo softwareupdate -i -a; brew update; brew upgrade; brew cleanup'
alias emptytrash='sudo rm -rfv /Volumes/*/.Trashes; sudo rm -rfv ~/.Trash; sudo rm -rfv /private/var/log/asl/*.asl; sqlite3 ~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV* '\''delete from LSQuarantineEvent'\'''
alias hide='defaults write com.apple.finder AppleShowAllFiles -bool false && killall Finder'
alias hidedesktop='defaults write com.apple.finder CreateDesktop -bool false && killall Finder'
alias show='defaults write com.apple.finder AppleShowAllFiles -bool true && killall Finder'
alias showdesktop='defaults write com.apple.finder CreateDesktop -bool true && killall Finder'
alias pumpitup='osascript -e '\''set volume output volume 100'\'''
alias stfu='osascript -e '\''set volume output muted true'\'''
alias spotoff='sudo mdutil -a -i off'
alias spoton='sudo mdutil -a -i on'

# core/more-tools aliases
alias grep='grep --color=auto'
alias egrep='grep -E --color=auto'
alias fgrep='grep -F --color=auto'

# brew
alias b='brew'
alias bi='brew install'
alias bic='brew install --cask'
alias buu='brew update && brew upgrade'
alias bgreedy='brew upgrade --greedy'
alias bs="brew search"

# git
alias gpp='git pull --prune'
alias gl="git log --graph --pretty=format:'%Cred%h%Creset %an: %s - %Creset %C(yellow)%d%Creset %Cgreen(%cr)%Creset' --abbrev-commit --date=relative"
alias gp='git push origin HEAD'
alias gd='git diff'
alias gc='git commit'
alias gca='git commit -a'
alias gco='git checkout'
alias gcb='git copy-branch-name'
alias gb='git branch'
# short-format + show branch and tracking info
alias gs='git status -sb' # overwrites ghostscript
alias gac='git add -A && git commit -m'
alias ge='git-edit-new'
alias changes='git diff --stat -r'
alias tracked='git ls-files -t'
alias untracked='git ls-files --others'
alias staged="git diff --name-only --cached"
gotorepo() {
  open "$(git remote get-url origin)"
}

# r
alias R="R --no-save --no-restore"
alias_fallback r radian R

# python
alias_fallback python python3
alias avenv="source .venv/bin/activate || source venv/bin/activate"
alias dvenv="deactivate"

# local folders
alias projects='cd ~/Documents/Projects/'
alias cnvim='cd ~/.config/nvim/'
alias dev='cd ~/Developer/'
alias notes='cd ~/Developer/notes'


# Helpful functions
nfiles() { rg --files "${1:-.}" --glob='!.DS_Store' | wc -l }
cleanup() {
  local dir="${1:-.}"
  if command -v fd >/dev/null 2>&1; then
    fd --hidden --type f -g '.DS_Store' "$dir" -x rm -v
  else
    find "$dir" -type f -name '.DS_Store' -print -delete
  fi
}

# Dev tmux session: nvim (top-left) | claude (top-right) | terminal (bottom)
nic() {
  local session_name="${1:-$(basename "$PWD")}"

  if [[ -n "$TMUX" ]]; then
    echo "Already in tmux. Detach first (prefix+d) or run from outside tmux."
    return 1
  fi

  if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux attach-session -t "$session_name"
    return
  fi

  tmux new-session -d -s "$session_name" -c "$PWD" -x "$(tput cols)" -y "$(tput lines)"
  tmux split-window -v -t "$session_name" -c "$PWD" -l 20%
  tmux split-window -h -t "$session_name":1.1 -c "$PWD" -l 30%

  tmux send-keys -t "$session_name":1.1 'nvim' C-m
  tmux send-keys -t "$session_name":1.2 'claude' C-m

  tmux select-pane -t "$session_name":1.1
  tmux attach-session -t "$session_name"
}

